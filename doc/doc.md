###В документации описана: 
* работа личного кабинета поставщика
* система интеграции с поставшиками
* система уведомлений о транзакциях 
* интеграция системы с базой данных менеджеров

###Контроллеры:

###SessionsController

####create 
Создание сессии для поставщика, успешно вошедшего в личный кабинет.

####destroy
Удаление сессии после выхода из личного кабинета.

###ApplicationController

####current_user
Данные поставщика, который зашел в личный кабинет.

####authorize
Авторизация поставщика в личном кабинете.

####session_auth
Создание сессии для конкретного пользователя системы.


###TransactionsController

####index
Отображает в личном кабинет в подменю "Транзакции" данные о прошедших транзакциях за текущий месяц.

####create
Отображает в личном кабинет в подменю "Транзакции" данные о прошедших транзакциях за выбранный месяц.

###CountersController

####index
Используется в личном кабинете. Отображает показания счетчиков пользователей в системе izkh авторизованного поставщика за текущий месяц. Данные: снимок, лицевой счёт, показания, дата. 

####create
Используется в личном кабинете. Отображает показания счетчиков пользователей в системе izkh авторизованного поставщика за выбранный месяц, по определенному лицевому счету пользователей или выбранной классификации счетчика. Данные: снимок, лицевой счёт, показания, дата. 

###EnergosbytController

####index
Испоьзуется на сайте izkh.ru для отображения задолжностей по поставщику Энерго-Сбыт.
Возвращает данные о пользователе: лицевой счет, город, улица, здание, квартира, время обхода, показания счетчиков, задолжность, дата.

####create
Записывает данные о добавление пользователя с поставщиков Энерго-Сбыт.Данные записываются в таблицу EnHandling. Данные: лицевой счет, id пользователя, ip пользователя. Используется в личном кабинете подменю "Запросы пользователей" только для Энерго-Сбыт.

####xls
Используется в личном кабинете подменю "Запросы пользователей" только для поставщика Энерго-Сбыт. Поставщик может выгрузить xls файл с дынными о колличестве добавленных пользователе с данными: лицевой счет, ip, дата.

####add_vendors
Выгрузка менеджеров Organizations.xls забирается с почты ivanova@izkh.ru и добавляет из нее новых поставщиков в базу серсиса izkh, базу личного кабинета поставщиков, в справочник поставщиков.

####auth_keys 
Отправка письма конкретному поставщику с его ключом в личный кабинет.

###AccountsController

####create
Используется при заведение новых поставщиков услуг и наличии выгрузки с задолжностями пользователей. Добавляет все данные из выгрузки поставщиков в таблицу Accounts.

####update
Используется при ежемесячной выгрузки от поставщиков. Данные пользователей обновляются в базе данных и для уже существующих пользователей в системе izkh формируются задолжности.

###OvdController

####ovd
Парсит базу участковых в xls файле и добавляет в базу данных.

####xls
Генерирует xls файл из xml выгрузки участковых. Таблица xls имеет следующие столбцы: Управляющий пункт, Адресс, Телефон, Участковый, Участок.

###PaymentsController

####create
Отправляет реестр транзакций за день менеджерам, поставщикам и на out@izkh.ru.

####monthly_xls
Оправляет реестр транзакции за месяц в xls поставщикам услуг, всем кроме Цифрал.

####monthly_txt
Оправляет реестр транзакции за месяц в txt поставщикам услуг. Используется для Цифрала.

####hourly
Отправляет реестр транзакций за последние три часа менеджерам.

####send\_report\_to\_vendors(report)
Метод отправки реестра транзакций поставщикам услуг.

###UserCheckController

####address
Выводит данные о задолжности пользователя по заданному адресу. Необходимо ввести город, улицу, здание, квартиру и id  поставщика.

####account
Выводит данные о задолжности пользователя по лицевому счету пользователя. Необходимо ввести лицевой счет и id поставщика.

###Класс Auth

####get
Получает ключ авторизации с сервиром izkh.

###Класс GetRequest

####report_daily
Запрашивает данные о транзакциях за день с сервиса. Используется для отправки на почту out@izkh.ru реестра транзакций.
Данные: {payload: amount, date, address, vendor\_id, user\_account}

####report_hourly
Запрашивает данные о транзакциях за последние три часа с сервиса. Используется для отправки транзакций менеджерам и поставщикамуслуг.
Данные: {payload: amount, date, address, vendor\_id, user\_account}


####report_monthly(month)
Запрашивает данные о транзакциях за текущий месяц с сервиса. Используется для отправки реестра транзакций поставщикам услуг.
Данные: {payload: amount, date, address, vendor\_id, user\_account}
		
####transactions(vendor\_id, month)
Запрашивает данные о транзакциях за месяц с сервиса по отпределенному поставщику. Используется в личном кабинете поставщиков для вывода всех транзакций.

####meters(vendor_id, month)
Запрашивает показания счетчиков за месяц с сервиса по отпределенному поставщику. Используется в личном кабинете поставщиков для вывода показаний.
		
####geocode(address)
Получает геокод по адресу поставщика из выгрузки менеджеров с geocode-maps.yandex.ru. Используется для получения картинки нахождения поставщика с yandex в справочнике поставщиков.

####nonutilityservicetype
Запрашивает данные о существующих сервивах в справочнике поставщиков на izkh. Используется при создание новых поставщиков.
	
####servicetypes
Запрашивает данные о существующих сервивах на izkh. Используется при создание новых поставщиков.
		
####cities
Запрашивает данные о существующих городах на izkh. Используется при создание новых поставщиков.

####vendor\_id(vendor\_id)
Запрашивает сушествующие аккаунты пользователей на сервисе. Используется для обновление задолжностей существующих пользователей из выгрузок поставщиков.

####freelancecategories
Запрашивает данные о существующих категориях фрилансеров на izkh. Используется при создание новых фрилансеров.

####vendors
Запрашивает данные о существующих пользователях на izkh. 
Данные: { vendor: id, title, inn, cities: [{id, title}] }

###Класс PostRequest
	
####non\_utility\_service\_type(title)
Создает новый сервис на izkh для справочника поставщиков из выгрузки менеджеров. Используется при создание новых поставщиков.Отсылается название сервиса.
:non\_utility\_service\_type => { title: }

####ervicetype(title)
Создает новый сервис на izkh. Используется при создание новых поставщиков из выгрузки менеджеров. Отсылается название сервиса.
:service_type => { title: }
	
####non\_utility\_vendor(title, phone, work\_time, address, non\_utility\_service\_type\_id, geocode)
Создает нового поставщика в справочнике поставщиков на izkh. Отсылается название организации, телефон, время работы, адресс, url карта места нахождения поставщика. На static-maps.yandex.ru отсылается доглота и широта, которые формируюся в методе geocode. Ответом будет url на статическую картинку. Данные берутся из выгрузки менеджеров.
:non\_utility\_vendor => { title:, phone:, work\_time:, address:, non\_utility\_service\_type\_id: },
:picture => { url: "http://static-maps.yandex.ru/1.x/?ll=#{geocode}&z=15&l=map&size=300,200&pt=#{geocode}" }

####non\_utility\_vendor\_with\_image(title, phone, work\_time, address, non\_utility\_service\_type\_id, image)
Создает нового поставщика в справочнике поставщиков на izkh. Отсылается название организации, телефон, время работы, адресс, url карта места нахождения поставщика. В url записывается место нахождения картинки. Используется при случае, когда static-maps.yandexru работает некорректно на заданный в выгрузке адресс. Данные берутся из выгрузки менеджеров.
:non\_utility\_vendor => { title:, phone:, work\_time:, address:, non\_utility\_service\_type\_id: },
:picture => { url: image }

####vendor(title, service\_type\_id, commission, cities)
Создает нового поставщика поставщиков на izkh. Отсылается название организации, сервис id, активность поставщика, комиссия, merchant id, psk и список городов, в которых дейтвует данный поставщик. Некоторые данные берутся из выгрузки менеджеров, другие заданны системой.
:vendor =>  { title:, service_type_id:, is\_active: true, commission: commission, merchant\_id: 43222, psk: "e45a8c7b-b0bd-4bdd-93d3-859b463daf81" },
:cities => cities }

####field\_template(tariff\_template\_id)
Создает поле доступа к поставщику на izkh. Все поля заданны автоматически. Испоьзуется при создание нового поставщика. 
:field\_template => { title: "Минимальная сумма платежа", value: 0, is\_for\_calc: false, tariff\_template\_id: tariff\_template\_id, field\_type: "text\_field", field\_units: "руб"}

####tariff\_template(vendor\_id, service\_type\_id)
Создает тариф к поставщику на izkh. Передается название тарифа и id сервиса.
:tariff\_template => { title:, vendor\_id:, has\_readings: false, service\_type\_id: }

####freelancer(freelance\_category\_id, description, phone, title, name)
Создает новых фрисансеров в izkh. Данные берутся из выгрузок менеджеров по фрилансерам. Отсылается категория, к которой относиться фрилансер, описание, телефон, заголовок в приложение, время работы, имя.
freelancer: { freelance\_category\_id:, description:, phone:, title:, work\_time:, name:}

####payload(data)
Создание задолжностей на izkh. Данные берутся из базы, сформированной выгрузками.

###Класс check\_email

####get_reports
Ищет на почте system@izkh.ru выгрузки от поставщиков за текущий день по email и добавляет их в папку report/#{DateTime.now.month}	#{DateTime.now.year}/#{filename}. Название файла соотвествует названию организации.

####get_organizations
Ищет на почте ivanova@izkh.ru выгрузку от менеджеров за текущий день по теме письма "Organozations" и добавляет их в папку 	organizations. К названию файла приписывается год-месяц-день.

###Класс DataProcessing

####amount\_to\_service(data, vendor_id)
Обновляет на сервере задолжности уже существующих пользователей из выгрузок поставщиков.

###Класс Energosbyt

####update
Парсер для выгрузки Энегро-Сбыта. 
Обновляет и создает данные о пользователях в моделе EnAcccount.
Данные: "user\_account", "city", "street", "building", "apartment", "bypass", "meter\_reading", "invoice\_amount", "data".

###Класс Freelancer

####parsing_file
Парсит выгрузки с фрилансерами

####categories
Запращивает данные о существующих категориях на сервисе izkh.

####check_categories
Добавляет недостающие категории из выгрузки фрилансеров к серсису.

####add_freelancers
Добавляет всех фрилансеров из выгрущки в сервис.

###Класс Organization

####add_vendors
Обновляет сервисы в izkh и справочнике поставщиков. Добавляет новых поставщиков в базу серсиса izkh, базу личного кабинета поставщиков, в справочник поставщиков. К сервису izkh добавляет тариф(tariff\_template), поле доступа(field\_template) и города, в которых действует поставщик. Высылает письмо поставщику при наличии email с ключом доступа в личный кабинет.

####check\_servicetype(title)
Обновляет данные о сервисах в izkh по выгрузки менеджеров при создание новых поставщиков.

####check\_non\_utility\_service\_types(title)
Обновляет данные о сервисах справочника поставщиков в izkh по выгрузки менеджеров при создание новых поставщиков.

####parsing\_file(file)
Парсит выгрузку менеджеров. Используется при заведение новых поставщиков.

####get\_type(type)
Создает список сервисов используемых в выгрузки менеджеров. Ипользуется для обновления сервисов в izkh и справочнике поставщиков.

####cities
Создает список городов существующих в izkh для добавления новых поставщиков с корректными id городов.

###Класс Ovd

####xml\_parser
Парсер выгрузки участковых из xml в базу по таблицам Precinct, Street, PrecinctHouse. Добавляет следующие данные:
в Precinct (ovd:, ovd\_town:, ovd\_street:, ovd\_house:, ovd\_telnumber:, surname:, name:, middlename:),
в Street   (street:),
в PrecinctHouse (precinct\_id:, street\_id:, house:)

####xls\_parser
Парсер выгрузки участковых из xls в базу по таблицам Precinct, Street, PrecinctHouse. Добавляет следующие данные:
в Precinct (ovd:, ovd\_town:, ovd\_street:, ovd\_house:, ovd\_telnumber:, surname:, name:, middlename:),
в Street   (street:),
в PrecinctHouse (precinct\_id:, street\_id:, house:)

####xml\_to\_xsl 
Выводит папку с выгрузками участковых xml в единым xls файл по следующим столбцам: Управляющий пункт, Адресс, Телефон, Участковый, Участок.

####merge
Объединяет две выгрузки участковых. Заменяет данные первого файла file\_ovd\_1 на file\_manager при условии, что участковый и его участок неизменен.

###Класс Getter
Абстрактный класс для парсеров.
	
####input
Выводит данные парсера в консоль.

####create
Создает новые аккаунты пользователей по определенной ораганизации из выгрузок поставщика. Используется при заведение новых поставщиков.

####update
Обновляет аккаунты пользователей по определенной ораганизации из выгрузок поставщика и добавляет новых.

###Класс Parser

####input
Абстрактным метод. 

####create
Создает новые аккаунты пользователей по определенной ораганизации из выгрузок поставщика в таблицу Account. Добавляет следующие данные: user\_account, city, street, building, apartment, invoice\_amount, vendor\_id.

####update
Обновляет аккаунты пользователей по определенной ораганизации из выгрузок поставщика и добавляет новых в таблицу Account. Добавляет следующие данные: user\_account, city, street, building, apartment, invoice\_amount, vendor\_id.

###Класс Dbf
Парсер для dbf файлов – выгрузки от поставщиков. Данные записывает в таблицу Accounts с следующими полями "user\_account", "city", "street", "building", "apartment", "invoice\_amount".

####input
Выводит эти данные в консоль.

####create
Сохраняет все данные в базу. Используется при заведение новых поставщиков услуг.

####update
Обновляет данные в базу и добавляет новые.

###Класс Txt
Парсер для txt файлов – выгрузки от поставщиков. Данные записывает в таблицу Accounts с следующими полями "user\_account", "city", "street", "building", "apartment", "invoice\_amount".

####input
Выводит эти данные в консоль.

####create
Сохраняет все данные в базу. Используется при заведение новых поставщиков услуг.

####update
Обновляет данные в базу и добавляет новые.

###Класс Ods
Парсер для ods файлов – выгрузки от поставщиков. Данные записывает в таблицу Accounts с следующими полями "user\_account", "invoice\_amount".

####input
Ищет какой метод парсинга приметить для заданного поставщика услуг. Выводит эти данные в консоль.

####create
Сохраняет все данные в базу. Используется при заведение новых поставщиков услуг.

####update
Обновляет данные в базу и добавляет новые.

####first\_colomn
Данные находятся в первой и третей конолке.

####privolga
Данные находятся в первой и шестой конолке.

###Класс Xls
Парсер для xls файлов – выгрузки от поставщиков. Данные записывает в таблицу Accounts с следующими полями "user\_account", "city", "street", "building", "apartment", "invoice\_amount".

####input
Ищет какой метод парсинга приметить для заданного поставщика услуг. Выводит эти данные в консоль.

####create
Сохраняет все данные в базу. Используется при заведение новых поставщиков услуг.

####update
Обновляет данные в базу и добавляет новые.

####standard
Парсер для жск\_219, ТСЖ "Уют" (Демократическая, 2), жск 199, 298
Расположение данных: (7:А)-(7:N)

#####Пример

	ЖЭУ	№ л/счета	Адрес					 Фамилия И. О.	  Расчетная площадь	 Кол-во проживающих	 Сальдо на 01/10/13	 Начислено	
	Период оплаты	Дата оплаты	 Оплачено  Пеня	 Списано сальдо  Сальдо на 30/11/13
	02	00001  		22-ПАРТСЪЕЗДА, 223-0001  ТУЛУМБАСОВА В.А. 65,00				 4					 3287,35			 6612,75	
	09/13			18.10.2013	 3400,00		 0,00	   		 3259		

####sokol
Парсер для ТСЖ Сокол
Расположение данных: (12:2)-(12:10)

#####Пример

	Здание												    Площ. Кол-во прож. Сумма на н.мес. Итого начис. Итого опл. Сумма на к.мес.
	Лицевой счет	Кв-ра			Квартиросъемщик						
	446020, Самарская обл, Сызрань г, Комарова ул, дом № 2  2693,1	82			88708,79	   159048,63	83390,05	164367,37
	л/с №1		Кв. 1			КНЯЗЕВА АЛЬБИНА СЕРГЕЕВНА	32,3	1			0		       2372,46		2372,46	 	0

####silver_creek
Парсер для Серебрянный ручей
Расположение данных: (8:2)-(8:25)

#####Пример

	№ п/п	Лицевой счет							Общая площадь	Итого начислено		Сумма на конец месяца
	1	Кв. 1, Ирикова Ритта Константиновна, л/с №1	49,80			2434,07				2434,07

####debt\_account
Парсер для ТСЖ Набережное
Расположение данных: (3:2)-(3:5)

#####Пример

	начисления за сентябрь		№ лицевого счета	№ квартиры ФИО
	3296,70						00000000001			1 Алашеева А.Г.

####first\_four
Парсер для Ивушка
Расположение данных: (2:1)-(2:2)

#####Пример

	л/сч	долг
	01	2 746,24

####three\_columns
Парсер для жск 254
Расположение данных: (7:1)-(7:2)

#####Пример

	 			Конечный остаток
	л/сч		Задолженность
				208247,25
	161-01	3 119,68

####two\_columns
Парсер для PTS, жск 268, птс-сервис, Спорт, 29, Бизнес Центр
Расположение данных: (1:1)

#####Пример

	Лицевые счета
	391001001

####other
Парсер для Промышленный №261 г.Самара ул.Губанова
Расположение данных: (2:1)-(2:2)

#####Пример

	Наименование		долг
	Дом 10 кв. 003	355,33

####one\_column
Парсер для 138
Расположение данных: (1:1)

#####Пример

	ул.Мориса Тореза,139
	00001

####one\_column2
Парсер для ЖСК №265
Расположение данных: (2:2)

#####Пример

	Л/С
	1

####first\_last
Парсер для ТСЖ №247 Б
Расположение данных: (3:1)-(3:4)

#####Пример

Лицевые счета ТСЖ № 247 "Б"   за ноябрь 2013 года			
	№ л/счёта	 сальдо на начало месяца	начисленно за текущий месяц	 итого к оплате
	30701		 4111,62					3895,37						 8006,99

###module Clockwork
Создает задачи на ежедневную отправку транзакций за день в 1:00, отправку транзакций за последние три часа менеджерам и поставщикам услуг в 1:00, 4:00, 8:00, 11:00, 14:00, 17:00, 20:00, 23:00.

###ReportMail

####report(message, vendor)
Отпрвляет письмо с транзакцями на почту поставщика.

####report_monthly(message, vendor)
Отпрвляет письмо с транзакцями на почту поставщика за месяц.

####report\_to_out
Отпрвляет письмо с транзакцями за день на out@izkh.ru.

####report\_to\_manager
Отпрвляет письмо с транзакцями за день на yusova@izkh.ru.

####no_transactions
Отправляет уведомление об отсутсвии транзакций за день на out@izkh.ru.

####error(message, message\_subject)
Отправляет список пользовательский транзакций с неизвестными системе лицевыми счетами.

####booker(recipient)
Отпрвляет письмо с транзакцями за день менеджерам.

####auth_keys(vendor)
Отправляет письмо поставщику с ключом от личного кабинета.

###Класс Payment
Абстрактный класс
	
####output
Абстрактный метод. Используется для создания и отправки реесторов о транзакциях.

####monthly
Абстрактный метод. Используется для создания и отправки реесторов о транзакциях за месяц.

###Класс Report

####output\_report
Используется для создания и отправки реесторов о транзакциях.

####monthly
Используется для создания и отправки реесторов о транзакциях за месяц.

####report
Запускает через sidekiq и clockwork ежедневную отправку транзакций за день на out@izkh.ru в 1:00. Также высылает список не найденных в системе аккаунтов пользователей. (отсутствуют данные аккаунты в выгрузках)

####report\_hourly
Запускает через sidekiq и clockwork отправку транзакций за последние три часа менеджерам и поставщикам услуг в 1:00, 4:00, 8:00, 11:00, 14:00, 17:00, 20:00, 23:00.

###Класс AllPayment
	
####output
Создает txt файл с данными о транзакциях за весь день и отправляется на out@izkh.ru. Файл содержит следующие данные о транзакции: аккаунт пользователя, адресс, сумма, дата, id поставщика.

###Класс Booker
	
####output
Создает txt файл с данными о транзакциях за последние три часа и отправляется на karpenko@izkh.ru, yusova@izkh.ru, Gluhovskaya.o@delta.ru Файл содержит следующие данные о транзакции: название поставщика, аккаунт пользователя, адресс, сумма, дата.

###Класс Error
	
####output
Создает txt файл с транзакциями пользователей, чьих аккаунтов нет в базе (отсутсвуют в выгрузках поставщиков) и оправляет на out@izkh.ru c темой Error.

###Класс ReportMonthly

####output
Создает xls файл с данными о транзакциях за месяц и сохраняет их в report\_monthly/#{DateTime.now.month}-#{DateTime.now.year}/ по заданному поставщику. Столбцы: Лицевой счет, Сумма, Дата.

###Класс ReportMonthlyTxt

####output
Создает txt файл с данными о транзакциях за месяц по заданному поставщику. Файл содержит следующие данные о транзакции: аккаунт пользователя, адресс, сумма, дата.

###Класс TxtCheckAddress

####output
Создает txt файл с данными о транзакциях для поставщиков услуг. Файл содержит следующие данные о транзакции: аккаунт пользователя, адресс, сумма, дата, id поставщика. Если данный аккаунт существует в базе вместо адресса введенного пользователям запишутся адресс из выгрузки поставщика. Используется для Цифрал.

###Класс TxtPayment

####output
Создает txt файл с данными о транзакциях для поставщиков услуг. Файл содержит следующие данные о транзакции: аккаунт пользователя, адресс, сумма, дата, id поставщика. 

###Класс ReportHourlyWorker

####perform
Отправляет реестр транзакций каждые три часа менеджерам и поставщикам услуг. Выводит в логи информацию о проведенной или об отсутсвии транзакций.

####send_report_to_vendors(report)
Метод отправки реестра транзакций поставщикам услуг.

###Класс ReportWorker

####perform
Отправляет ежедневный реестр транзакций в 1.00 на out@izkh.ru и yusova@izkh.ru.
